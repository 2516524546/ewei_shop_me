<!DOCTYPE html>
<html lang="en">
     <head>
        <meta charset="UTF-8">
        <title>Address Book</title>
        <meta name="viewport" content="width=device-width, initial-scale=0 user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
        <link rel="stylesheet" href="__PUBLIC__/Web/web/css/register.css">
        <link rel="stylesheet" href="__PUBLIC__/Web/web/css/Donation.css">
        <link rel="stylesheet" href="__PUBLIC__/Web/web/css/Crumbsnav.css">
        <link rel="stylesheet" href="__PUBLIC__/Web/js/lib/bootstrap/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="__PUBLIC__/Web/js/lib/bootstrap/dist/css/bootstrap-grid.min.css">
        <link rel="stylesheet" href="__PUBLIC__/Web/js/lib/bootstrap/dist/css/bootstrap-reboot.min.css">
        <link rel="stylesheet" href="__PUBLIC__/Web/js/lib/layui/dist/css/layui.css">
        <link rel="stylesheet" href="__PUBLIC__/Web/web/css/Crumbsnav.css">
        <link rel="stylesheet" href="__PUBLIC__/Web/web/css/success_index.css">
        <link rel="stylesheet" href="__PUBLIC__/Web/web/css/AddressBook.css">
        <link rel="stylesheet" href="__PUBLIC__/Web/web/css/common.css">
        <style>
        .btn-change-primary{
            color: #fff;
            background-color: #007bff;
            border-color: #007bff;
        }
        </style>
    </head>

    <body>
        <div class="web">
            <!-- logo -->
           <header class="container">
               <include file = "./World/Index/View/Public/head.html"/>
               </header>
               <hr>
   
           <!-- Crumbs nav -->
           <div class="container">
                   <div class="row">
                       <div class="col-md-6 crumbs">
                               <a href="index.html" class="crumbsa"><img src="__PUBLIC__/Web/web/img/common_dh_icon_home.png" alt=""></a>
                               <cite class="Icon"></cite>
                               <span class="crumbsTitle">Address Book</span>
                           </div>
                           <div class="col-md-6">
                               <div class="SelectionContainer">
                                   <input type="text" class="layui-input" id="Selectionform">
                                   <span id="SelectionIcon">
                                   <img src="__PUBLIC__/Web/web/img/02_interest/interest_qxx_search_icon.png">
                                   </span>
                               </div>
                           </div>
                   </div>
               </div>
   
   
           <!-- AddressBook content -->
           <div class="container section">
               <div class="AddressBook_box">
                   <foreach name="myFirends" item="m">
                   <div class="AddressBook_item">
                       <div class="AddressBook_left">
                           <a href="PersonalCenter.html">
                               <div class="AddressBook_left_img">
                                   <img src="<if condition='$m["user_icon"]'>./Uploads/{$m['user_icon']}<else />__PUBLIC__/Web/web/img/01_shouye/UserPic.png</if>" alt="">
                               </div>
                               <div class="AddressBook_left_user">
                                   <if condition="$m['firends_mark']">{$m['firends_mark']}<else/>{$m['user_name']}</if>
                               </div>
                       </a>
                           </div>
       
                           <div class="AddressBook_right">
                               <div class="AddressBook_btn AddressBook_ChangeName" data-id="{$m['friends_id']}" data-toggle="modal" data-target="#box2">
                                       Set Alias
                               </div>
                               <div class="AddressBook_btn AddressBook_Delete" data-uid="{$m['firends_uid']}"  data-aid="{$m['firends_aid']}"  data-toggle="modal" data-target="#box1">
                                       Delete
                               </div>
                           </div>
   
                   </div>
                   </foreach>
               </div>
               <div class="container" id="NumberOfPagesContainer">
                   {$page}
               </div>
   
               <!-- 删除 -->
                       <div id="box1" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
                           <div class="modal-dialog modal-sm" role="document">
                               <div class="modal-content">
                                   <div class="modal-header">
                                       <span class="modal-title">
                                               Tips
                                           </span>
                                       <a class="close" data-dismiss="modal" aria-label="Close" style="position: absolute;right: 10px;top: 16px;">
                                               <span aria-hidden="true">&times;
                                           </a>
                                   </div>
                                   <div class="modal-body">
                                       <p class="text-center">Do you delete the occupation?</p>
                                   </div>
                                   <div class="modal-footer">
                                       <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                       <button type="button" class="btn btn-primary" data-dismiss="modal">confirm</button>
                                   </div>
                               </div>
                           </div>
                       </div>
   
                       <!-- 修改 -->
                       <div id="box2" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
                           <div class="modal-dialog modal-sm" role="document">
                               <div class="modal-content">
                                   <div class="modal-header">
                                       <span class="modal-title">
                                               Tips
                                           </span>
                                       <a class="close" data-dismiss="modal" aria-label="Close" style="position: absolute;right: 10px;top: 16px;">
                                               <span aria-hidden="true">&times;
                                           </a>
                                   </div>
                                   <div class="modal-body">
                                       <span>Alias :</span>
                                       <input type="text" placeholder="Please enter the alias" class="box2_input">
                                   </div>
                                   <div class="modal-footer">
                                       <button type="button" class="btn btn-change-default" data-dismiss="modal">Cancel</button>
                                       <button type="button" class="btn btn-change-primary " data-dismiss="modal">confirm</button>
                                   </div>
                               </div>
                           </div>
                       </div>
           </div>
   
   
           <!-- footer -->
           <footer class="footer">
               <include file = "./World/Index/View/Public/footer.html"/>
           </footer>

        </div>

    </body>
    <script src="__PUBLIC__/Web/js/lib/jquery/dist/jquery.min.js"></script>
    <script src="__PUBLIC__/Web/js/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="__PUBLIC__/Web/js/lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="__PUBLIC__/Web/js/lib/layui/dist/layui.all.js"></script>
    <script src="__PUBLIC__/Web/web/js/loginQuit.js"></script>
    <script>
            $(function(){
                (function(){
                    var num;
                    $(".AddressBook_box").on('click',".AddressBook_item", function(event) {
                        event.preventDefault();
                        num = $(this).index();
                    });
                    $(".btn-primary").on('click', function(event) {
                        var firends_uid = $(".AddressBook_box .AddressBook_item .AddressBook_right .AddressBook_Delete").eq(num).data('uid')
                        var firends_aid = $(".AddressBook_box .AddressBook_item .AddressBook_right .AddressBook_Delete").eq(num).data('aid')
                        $.post(
                            '{:U("User/DeleteFriend")}',
                            {firends_uid:firends_uid,firends_aid:firends_aid},
                            function(data){
                                if(data.status == 0){
                                    alert(data.msg);
                                }else{
                                    //alert(data.msg);
                                    $(".AddressBook_box .AddressBook_item").eq(num).remove();
                                }
                            },'json'
                        );
                    });
                })();
                
            });
        </script>
    
        <!-- 点击更改名字 -->
        <script>
                $(function(){
                    (function(){

                        $('#SelectionIcon').on('click',function(){
                            window.location.href = '{:U('Index/User/addressBook')}'+ '&k=' + $('#Selectionform').val();
                        })

                        var num2;
                        $(".AddressBook_box").on('click', ".AddressBook_item" , function(event) {
                            event.preventDefault();
                            num2 = $(this).index();
                        });
                        $(".btn-change-primary").on('click', function(event) {
                            if($(".box2_input").val()){
                                var friends_id = $(".AddressBook_box .AddressBook_item .AddressBook_right .AddressBook_ChangeName").eq(num2).data('id')
                                $.post(
                                    '{:U("User/SetFriendAlias")}',
                                    {friends_id:friends_id,firends_mark:$(".box2_input").val()},
                                    function(data){
                                        if(data.status == 0){
                                            alert(data.msg);
                                        }else{
                                            alert(data.msg);
                                            $(".AddressBook_box .AddressBook_item .AddressBook_left .AddressBook_left_user").eq(num2).html($(".box2_input").val())
                                            $(".box2_input").val("")
                                        }
                                    },'json'
                                );
                            }else{
                                alert("不能为空")
                            }
                        });
                    })();
                    
                });
        </script>
</html>